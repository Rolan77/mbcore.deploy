- name: Build node on a new machine
  hosts:
    - stage
  become: yes
  pre_tasks:
    - name: Install required system packages
      apt: name=python3-pip state=latest update_cache=yes
    - name: Install Docker Module for Python
      pip:
        name: docker
  roles:
    - certbot
    - docker
    - nginx
  post_tasks:
    - name: Pull docker image
      community.docker.docker_image:
        name: gordon77/mbcorecrnode:latest
        source: pull
  vars:
    docker_users:
      - "{{ ansible_user }}"
    docker_install_compose: true
